<div class="scene">
  <div id="snow-container"></div>

  <div class="decor-tree left">ğŸŒ²</div>
  <div class="decor-tree right">ğŸŒ²</div>
  <div class="decor-stars">
    <div class="star" style="top: 10%; left: 15%;">â­</div>
    <div class="star" style="top: 20%; left: 80%;">âœ¨</div>
    <div class="star" style="top: 15%; left: 50%;">ğŸ’«</div>
  </div>

  <div class="nav-tabs">
    <div class="nav-item" [class.active]="currentView === 'gifts'" (click)="switchView('gifts')">ğŸ Lá»i chÃºc</div>
    <div class="nav-item" [class.active]="currentView === 'calendar'" (click)="switchView('calendar')">ğŸ“… Lá»‹ch ({{collectedCount}}/31)</div>
    <button class="nav-item" [class.active]="currentView === 'collection'" (click)="switchView('collection')">ğŸ† SÆ°u Táº§m</button>
  </div>

  <div class="collection-view" *ngIf="currentView === 'collection'">
    <div class="collection-header">
      <h2>HÃ nh TrÃ¬nh GiÃ¡ng Sinh</h2>
      <div class="progress-bar-container">
        <div class="progress-info">
          <span>ÄÃ£ thu tháº­p: {{collectedCount}} tem</span>
          <span>Má»¥c tiÃªu: 25 tem</span>
        </div>
        <div class="progress-track">
          <div class="progress-fill" [style.width.%]="(collectedCount / 25) * 100"></div>
        </div>
      </div>
    </div>

    <div class="milestones-grid">
      <div class="milestone-card" *ngFor="let m of milestones"
           [class.locked]="!m.isUnlocked"
           [class.claimed]="m.isClaimed"
           (click)="claimReward(m)">

        <div class="m-icon">{{m.isUnlocked ? m.icon : 'ğŸ”’'}}</div>
        <div class="m-content">
          <div class="m-level">Má»‘c {{m.level}} Tem</div>
          <div class="m-name">{{m.name}}</div>
          <div class="m-status">
            <span *ngIf="m.isClaimed" class="st-claimed">ÄÃ£ nháº­n âœ”ï¸</span>
            <span *ngIf="!m.isClaimed && m.isUnlocked" class="st-claim-now">Nháº¥n Ä‘á»ƒ nháº­n! ğŸ</span>
            <span *ngIf="!m.isUnlocked" class="st-locked">ChÆ°a Ä‘áº¡t</span>
          </div>
        </div>
        <div *ngIf="m.isUnlocked && !m.isClaimed" class="glow-effect"></div>
      </div>
    </div>
  </div>

  <div class="content-wrapper">

    <div class="view-gifts" *ngIf="currentView === 'gifts'">
      <div class="countdown-section" *ngIf="!showGifts">
        <div class="countdown-decoration">â„ï¸ Christmas Countdown â„ï¸</div>
        <div class="countdown-timer">
          <div class="time-unit snow-cap"><div class="time-value">{{ daysUntilChristmas }}</div><div class="time-label">NgÃ y</div></div>
          <div class="time-separator">:</div>
          <div class="time-unit snow-cap"><div class="time-value">{{ hoursUntilChristmas }}</div><div class="time-label">Giá»</div></div>
          <div class="time-separator">:</div>
          <div class="time-unit snow-cap"><div class="time-value">{{ minutesUntilChristmas }}</div><div class="time-label">PhÃºt</div></div>
          <div class="time-separator">:</div>
          <div class="time-unit snow-cap"><div class="time-value">{{ secondsUntilChristmas }}</div><div class="time-label">GiÃ¢y</div></div>
        </div>
      </div>

      <div class="hero-section" *ngIf="!showGifts">
        <div class="santa-container"><div class="santa-icon">ğŸ…</div></div>
        <h1 class="main-title">
          <span class="title-line">Merry Christmas</span>
          <span class="title-line subtitle-glow">2025</span>
        </h1>
        <button class="start-btn" (click)="revealGifts()" (mouseenter)="playHover()">
          <span class="btn-icon">ğŸ</span><span>KhÃ¡m PhÃ¡</span><span class="btn-shine"></span>
        </button>
      </div>

      <div class="gift-section" *ngIf="showGifts && !showCard">
        <h2 class="section-title fancy-title">
          <span class="title-icon glow-icon">ğŸ„</span>
          <span class="title-text">âœ¨ VÃ i Lá»i ChÃºc Giáº£n ÄÆ¡n âœ¨</span>
          <span class="title-icon glow-icon">ğŸ„</span>
        </h2>

        <div class="gifts-container">
          <div class="gift-card" *ngFor="let card of cards; let idx = index"
               (click)="openCard(idx)" (mouseenter)="playHover()">
            <div class="gift-box">
              <div class="gift-icon">{{ card.icon }}</div>
            </div>
            <p class="gift-label">Lá»i ChÃºc {{ idx + 1 }}</p>
          </div>
        </div>
      </div>

      <div class="card-section" *ngIf="showCard && currentCard">
        <div class="animated-card" [style.background]="currentCard.color">
          <div class="card-decoration" *ngFor="let deco of currentCard.decorations; let i = index" [style.top]="[10, 15, 85, 90][i] + '%'" [style.left]="[5, 90, 10, 85][i] + '%'">{{ deco }}</div>
          <div class="card-content">
            <div class="card-icon-container"><div class="icon-glow"></div><div class="card-icon">{{ currentCard.icon }}</div></div>
            <h1 class="card-title">{{ currentCard.title }}</h1>
            <div class="card-divider"><span class="divider-line"></span></div>
            <div class="message-container"><div class="message-content-wrapper"><p class="card-message">{{ typingText }}<span class="cursor" *ngIf="showCursor">|</span></p></div></div>
            <div class="card-signature"><div class="wax-seal"><span>S</span></div><p class="signature-text">From Santa with Love</p></div>
          </div>
          <div class="card-shine shine-1"></div>
          <div class="corner-deco top-left">â„ï¸</div><div class="corner-deco top-right">â„ï¸</div><div class="corner-deco bottom-left">â„ï¸</div><div class="corner-deco bottom-right">â„ï¸</div>
        </div>
        <button class="retry-btn" (click)="resetCard()" (mouseenter)="playHover()">ğŸ”„ Chá»n láº¡i</button>
      </div>
    </div>

    <div class="view-calendar" *ngIf="currentView === 'calendar'">
      <h2 class="section-title month-title">
        <span class="title-icon rainbow">â„ï¸</span>
        <span class="title-text rainbow-text">ThÃ¡ng 12</span>
        <span class="title-icon rainbow">â„ï¸</span>
      </h2>

      <div class="calendar-container">
        <div class="calendar-header"><div class="weekday" *ngFor="let day of weekDays">{{ day }}</div></div>
        <div class="calendar-grid">
          <div class="calendar-door empty" *ngFor="let empty of emptySlots"></div>
          <div class="calendar-door" *ngFor="let item of calendarDays"
               [class.checked-in]="item.isOpen" [class.locked]="item.isLocked" [class.shake]="item.isShaking"
               [class.special-day]="item.day === 24 || item.day === 25"
               (click)="openCalendarDoor(item)" (mouseenter)="playHover()">
            <div class="door-front" *ngIf="!item.isOpen">
              <span class="date-text">{{ item.day }}</span>
              <span class="special-icon" *ngIf="item.day === 24">ğŸ¦Œ</span><span class="special-icon" *ngIf="item.day === 25">ğŸ…</span>
              <span class="lock-icon" *ngIf="item.isLocked">ğŸ”’</span>
            </div>
            <div class="door-back" *ngIf="item.isOpen">
              <span class="sticker-img">{{ item.image }}</span><span class="check-mark">âœ”</span>
              <div class="rarity-dot" [ngClass]="{'dot-rare': item.rarity==='rare','dot-epic': item.rarity==='epic','dot-legendary': item.rarity==='legendary'}"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="popup-overlay" *ngIf="showRewardPopup && currentReward">
    <div class="popup-content reward-popup">
      <div class="close-btn" (click)="closeRewardPopup()">Ã—</div>
      <div class="reward-icon">{{currentReward.icon}}</div>
      <h3>ChÃºc Má»«ng!</h3>
      <p class="reward-name">{{currentReward.name}}</p>
      <p class="reward-desc">{{currentReward.description}}</p>
      <button class="btn-primary" (click)="closeRewardPopup()">Tuyá»‡t Vá»i!</button>
    </div>
  </div>

  <div class="calendar-popup-overlay" *ngIf="showCalendarPopup && selectedCalendarItem">
    <div class="premium-popup-card" [class.popup-rare]="selectedCalendarItem.rarity === 'rare'" [class.popup-legendary]="selectedCalendarItem.rarity === 'legendary'">
      <div class="popup-inner-border">
        <div class="rarity-badge" [class.badge-rare]="selectedCalendarItem.rarity === 'rare'" [class.badge-legendary]="selectedCalendarItem.rarity === 'legendary'">{{ selectedCalendarItem.rarity | uppercase }}</div>
        <div class="popup-ribbon">NgÃ y {{ selectedCalendarItem.day }}</div>
        <div class="popup-icon-container">
          <div class="popup-glow"></div>
          <div class="popup-main-icon sticker-anim">{{ selectedCalendarItem.image }}</div>
        </div>
        <div class="popup-text-content">
          <h3 class="popup-heading">{{ selectedCalendarItem.title }}</h3>
          <p class="popup-message">"{{ selectedCalendarItem.content }}"</p>
        </div>
        <button class="premium-btn" (click)="closeCalendarPopup()">Tuyá»‡t vá»i! â¤ï¸</button>
      </div>
      <div class="deco-corner tl">â„ï¸</div><div class="deco-corner tr">â„ï¸</div><div class="deco-corner bl">â„ï¸</div><div class="deco-corner br">â„ï¸</div>
    </div>
  </div>

  <div class="reindeer-container" *ngIf="showReindeerFly">
    <div class="reindeer-sleigh">ğŸ¦ŒğŸ¦ŒğŸ›·ğŸ…</div>
    <div class="snow-storm"></div>
  </div>

  <div class="fireworks-container" *ngIf="showFireworks">
    <canvas id="fireworks-canvas" style="display: block; width: 100%; height: 100%;"></canvas>
    <div class="grand-banner big" id="merry-banner">
      <div class="banner-ribbon">
        <div class="banner-content"><span class="banner-star">ğŸŒŸ</span>MERRY CHRISTMAS<span class="banner-star">ğŸŒŸ</span></div>
        <div class="banner-tail left"></div><div class="banner-tail right"></div>
      </div>
      <div class="banner-subtext">2025</div>
    </div>
  </div>

  <div class="opening-overlay" *ngIf="isOpening">
    <div class="opening-gift-container">
      <div class="opening-gift-box"><div class="gift-icon big-icon">ğŸ</div></div>
    </div>
  </div>

  <button class="music-btn" (click)="toggleMusic()" [class.playing]="isMusicPlaying"><span class="music-icon">{{ isMusicPlaying ? 'ğŸ”Š' : 'ğŸ”‡' }}</span></button>

  <div class="footer-decor"><div class="snow-ground"></div></div>
</div>
